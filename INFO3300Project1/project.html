<html>
<head>
<title>The Evolution of NBA Shooting</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css?family=Oswald" rel="stylesheet">
<script src='https://d3js.org/d3.v4.min.js'></script>
<script src='data.js'</script>
<script src='//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js'></script>
<script src="https://rawgit.com/susielu/d3-annotation/master/d3-annotation.min.js"></script>

<style>
body{
  background-color: #081698;
  font-family: 'Oswald', sans-serif;
}
#container{
  width: 90%;
  height: auto;
  background-color: white;
  margin: auto;
}
img{
  display: inline-block;
  width:10%;
  vertical-align: middle;
}
h1{
  display: inline-block;
  vertical-align: middle;
}
h3{
  display: block;
  width: 90%;
  margin: auto;
  text-align: center;
  padding: 0.5em;
}
#zero, #one, #two{
  margin:1em;
  padding: 1em;
  border: solid 1px;
  display: block;
  margin:auto;
  background-image: url("court.png");
  background-repeat: no-repeat;
  background-size: 700px 470px;
  background-position: center; 
}
@media only screen and (max-width: 1275px) {
#key1, #key2, #key3, #key4, #key5, #key6{
  
  margin:1em;
  padding: 1em;
  display: block;
  margin:auto;
}
}
@media only screen and (min-width: 1275px){
  #key1, #key2, #key3, #key4, #key5, #key6{
  width: 43%;
  margin:1em;
  padding: 1em;
  display: inline-block;
}
}
</style>
</head>
<body>



<div id="background" >
  <div id="container">

    <div style="width:100%; padding:1em;">
      <img alt="http://bleacherreport.com/nba" src="nba.png" ></img>
      <!-- img link: http://bleacherreport.com/nba -->
      <h1>The Evolution of NBA Shooting</h1>

      <p style="padding:1em; width:90%;"> It's clear that the game of basketball is changing, particularly in the NBA. In the modern era, the Golden State Warriors have built a dynasty by taking three point shots at historic rates, and the Houston Rockets nearly upended them by pushing the envelope even farther. To what extent has evolution in shot selection led to more efficient offense league-wide? We analyzed the frequency of shots taken at different locations on the court and the efficiency of those shot attempts during every single season over the past two decades. </p>
    </div>

    <svg id="key3" width ="600" height="90">
              <defs>

      <linearGradient id="efficiency">
        <stop class="stop1" offset="0%"/>
        <stop class="stop2" offset="33%"/>
        <stop class="stop3" offset="66%"/>
        <stop class="stop4" offset="100%"
      </linearGradient>
      <style type="text/css"><![CDATA[
        #rect1 { fill: url(#efficiency); }
        .stop1 { stop-color: #e02900; }
        .stop2 { stop-color: #ffcc00; stop-opacity: 1; }
        .stop3 { stop-color: #72af01; }
        .stop4 { stop-color: #0c9600}
      ]]></style>
  </defs>
    <text x="40" y="30" alignment-baseline="middle" text-anchor="middle"> Points Per Attempt: </text>
    <rect id="rect1" x="100" y="10" rx="15" ry="15" width="400" height="40"/>
    <text x="90" y="70" alignment-baseline="middle" text-anchor="middle"> 0.7 </text>
    <text x="290" y="70" alignment-baseline="middle" text-anchor="middle"> 1 </text>
    <text x="490" y="70" alignment-baseline="middle" text-anchor="middle"> 1.3 </text>
    
    </svg>
    <svg id="key4" width ="500" height="80">
    <text x="30" y="20" alignment-baseline="middle" text-anchor="middle"> Shot Frequency: </text>
    <text x="100" y="70" alignment-baseline="middle" text-anchor="middle"> Low </text>
    <text x="250" y="70" alignment-baseline="middle" text-anchor="middle"> Medium </text>
    <text x="400" y="70" alignment-baseline="middle" text-anchor="middle"> High </text>
    </svg>
    
    <script>
      var svg = d3.select("#key4");
      for (var i = 0; i < 8; i++){
        svg.append('circle')
        .attr('cx', 50 + (50 * i))
        .attr('cy', 20)
        .attr('r', i)
        .attr('fill', "black");
  }
    </script>
    <div style="text-align: center">
      <label>Year: </label>
         <input id="year" oninput="slide()" type="range" min="1998" max="2018" value="1998" 
          style="width: 500px; background: transparent; outline: none;">
    </div>
      <h3 id="head">1997 - 1998 Season </h3>
      <svg id="zero" width='700' height='470'></svg>
      <br><br>

      <p style="padding:1em; width:90%;"> </p>

  <script>
    var svg0 = d3.select('#zero')
  //based on code on d3 annotation circles on http://d3-annotation.susielu.com
        const annotations = [
        {
          type: d3.annotationCalloutCircle,
          note: {
            label: "In the 1990s, teams took lots of inefficient mid-range shots",
            title: "Low-Percentage Long 2s",
            wrap: 190
          },
          subject: {
            color: "red",
            radius: 50
          },
          x: 200,
          y: 410,
          dy: -207,
          dx: -22
        }].map(function(d){ d.color = "red"; return d})
        const makeAnnotations = d3.annotation()
          .type(d3.annotationLabel)
          .annotations(annotations)

        const annotations1 = [
        {
          type: d3.annotationCalloutCircle,
          note: {
            label: "In the 2000s, teams shift from long baseline 2s to corner 3s",
            title: "Corner 3s Become Popular",
            wrap: 190
          },
          subject: {
            color: "red",
            radius: 50
          },
          x: 100,
          y: 410,
          dy: -277,
          dx: 0
        },{
        type: d3.annotationCalloutCircle,
          note: {
            label: "Teams begin to use analytics, shoot more beyond the arc",
            title: "Increase in 3s",
            wrap: 190
          },
          subject: {
            color: "red",
            radius: 50
          },
          x: 520,
          y: 230,
          dy: -107,
          dx: 10
        }
        ].map(function(d){ d.color = "red"; return d})
        const makeAnnotations1 = d3.annotation()
          .type(d3.annotationLabel)
          .annotations(annotations1)

        const annotations2 = [
        {
          type: d3.annotationCalloutCircle,
          note: {
            label: "Less efficient long 2s are disappearing from the game",
            title: "No More Mid-Range",
            wrap: 190
          },
          subject: {
            color: "red",
            radius: 50
          },
          x: 220,
          y: 330,
          dy: -177,
          dx: -30
        },{
        type: d3.annotationCalloutCircle,
          note: {
            label: "The secret that 3 is worth more than 2 must have gotten out",
            title: "3-Point Explosion",
            wrap: 190
          },
          subject: {
            color: "red",
            radius: 50
          },
          x: 520,
          y: 230,
          dy: -107,
          dx: 10
        }
        ].map(function(d){ d.color = "red"; return d})
        const makeAnnotations2 = d3.annotation()
          .type(d3.annotationLabel)
          .annotations(annotations2)

// scale number of shot attempts to size of circle
var rScale = d3.scaleSqrt()
.domain([20,300])
.range([0, 8])
// scale effective percentage to color of circle
var colorScale = d3.scaleLinear()
  .domain([.35, .45, .55, .65])
  .range(["#e02900", "#ffcc00", "#72af01", "#0c9600"]);

// iteratre through all elements of the 2D arrays, each value of which represents makes/attempts for a specific sqaure-foot of the court
function slide(){
  svg0.selectAll("*").remove();
  var y = document.getElementById("year").value;
  document.getElementById("head").innerHTML = (y-1).toString() + "-" + y.toString().substring(2,4) + " Season";
  var year = y - 1998;

  /*if (y == 1998){
    svg0
      .append("g")
      .attr("class", "annotation-group")
      .call(makeAnnotations)
  } else if (y == 2018){
    svg0
      .append("g")
      .attr("class", "annotation-group")
      .call(makeAnnotations2)
  }*/

  for(var i = 0; i < makes2[year].length; i++) {
    for(var j = 0; j < makes2[year][i].length; j++) {
      var percentage = (makes2[year][i][j] / (attempts2[year][i][j] + 0.01))
      var color;
      // for outliers in percentage, manually set the color
      if (percentage < 0.35) {
        color = "#e02900"
      } else if (percentage > .65){
        color = "#0c9600"
      } else {
      // apply the color scale to the percentage
        color = colorScale(makes2[year][i][j] / (attempts2[year][i][j] + 0.01))
      }
      // append a circle to the SVG at the coordinates determined by the indeces of the array
      if (attempts2[year][i][j] > 20 && attempts2[year][i][j] < 300) {
          svg0.append('circle')
        .attr('cx', i*10+105)
        .attr('cy', 470 - (j*10+10))
        .attr('r', rScale(attempts2[year][i][j]+0.01))
        .attr('fill', color)
      }
      // for large outliers in number of attempts, manually set the radius to larger than those on the scale
      else if (attempts2[year][i][j] > 20) {
        svg0.append('circle')
          .attr('cx', i*10+105)
          .attr('cy', 470 - (j*10+10))
          .attr('r', 9)
          .style('fill', color)
      }
    }
  }
}

slide();

  </script>
  </div> <!-- end of container div -->
</div><!-- end of background div -->
</body>
</html>
